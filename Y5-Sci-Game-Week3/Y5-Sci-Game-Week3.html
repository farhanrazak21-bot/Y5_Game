<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Y3 Science ‚Äî Plants Interactive</title>
<style>
  :root{--bg:#0f172a;--panel:#0b1220;--card:#111827;--muted:#9aa4b2;--ok:#22c55e;--warn:#f59e0b;--err:#ef4444;--blue:#60a5fa}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;background:var(--bg);color:#e5e7eb}
  header{position:sticky;top:0;background:var(--panel);border-bottom:1px solid #1f2937;padding:16px;z-index:10}
  h1{margin:0;font-size:20px}
  .sub{color:var(--muted);font-size:13px}
  .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
  .tab{background:var(--panel);border:1px solid #243042;border-radius:10px;color:#e5e7eb;padding:10px 12px;cursor:pointer}
  .tab.active{border-color:var(--ok);box-shadow:0 0 0 2px #14532d inset}
  .wrap{max-width:1180px;margin:16px auto;padding:0 16px;display:grid;gap:16px}
  @media(min-width:1100px){.wrap{grid-template-columns:1.45fr .55fr}}
  .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:16px}
  .panel{background:#0b1220;border:1px solid #253042;border-radius:12px;padding:10px}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .result{margin-top:10px;padding:10px;border-radius:10px;background:var(--panel);border:1px solid #1f2937}
  .muted{color:var(--muted)} .ok{color:var(--ok)} .err{color:var(--err)}
  button{background:var(--panel);border:1px solid #253042;border-radius:10px;color:#e5e7eb;padding:10px 12px;cursor:pointer}
  button.primary{background:linear-gradient(135deg,#16a34a,#22c55e);border:none;color:#06210d}
  button.warn{background:#1f1300;border:1px solid #6b4e00;color:#ffd166}
  input,select,textarea{background:var(--panel);border:1px solid #253042;border-radius:10px;color:#e5e7eb;padding:10px}
  .stage{min-height:340px;display:flex;align-items:center;justify-content:center;background:#0b1220;border:1px solid #253042;border-radius:14px;padding:12px}
  .grid{display:grid;gap:10px}
  .grid-2{grid-template-columns:repeat(2,1fr)}
  .grid-3{grid-template-columns:repeat(3,1fr)}
  .grid-4{grid-template-columns:repeat(4,1fr)}
  .tile{background:#0f1a2a;border:1px solid #263246;border-radius:12px;padding:12px;text-align:center;cursor:pointer}
  .tile.sel{outline:3px solid #22c55e}
  .drop{min-height:84px;border:2px dashed #334155;border-radius:12px;padding:8px;display:flex;gap:8px;flex-wrap:wrap}
  .chip{display:inline-flex;align-items:center;justify-content:center;padding:8px 12px;border:1px solid #2a3646;border-radius:999px;background:#0b1220;margin:6px;cursor:grab}
  .badge{font-size:12px;padding:2px 6px;border:1px solid #2a3646;border-radius:999px}
  .tiny{font-size:12px;color:#9aa4b2}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  .big{font-size:18px}
</style>
</head>
<body>
  <header>
    <h1>Y3 Science ‚Äî Plants Interactive</h1>
    <div class="sub">Plant parts ‚Ä¢ Functions ‚Ä¢ Water transport (ECOL7) ‚Ä¢ Reflection (Alhamdulillah for creation)</div>
    <div class="tabs">
      <button class="tab active" data-tab="lead">0) üåø Lead‚Äëin</button>
      <button class="tab" data-tab="label">1) üè∑Ô∏è Label the Plant</button>
      <button class="tab" data-tab="match">2) üîó Match Part ‚Üí Function</button>
      <button class="tab" data-tab="xylem">3) üíß Water Travel (Xylem Explorer)</button>
      <button class="tab" data-tab="quiz">4) üß© Quick Quiz</button>
    </div>
  </header>

  <div class="wrap">
    <section class="card" id="main">
      <h2 style="margin:0 0 8px">Activity Panel</h2>
      <div id="view"></div>
    </section>

    <aside class="card">
      <h3 style="margin:0 0 8px">Teacher Prompts & Values</h3>
      <div class="panel">
        <ul class="muted" style="margin-left:18px">
          <li>Begin with salam + short <b>dua</b> for knowledge.</li>
          <li>Ask observation Qs: colour, shape, size, smell. "What does this part do?"</li>
          <li><b>ECOL7</b>: Plants are living systems with special structures.</li>
          <li>Faith link: Say <b>Alhamdulillah</b> for Allah's design in roots, stems, leaves, flowers.</li>
          <li>Differentiation: fewer options & larger tiles for less‚Äëable; add seed/fruit and extra functions for more‚Äëable.</li>
        </ul>
      </div>
      <div class="result panel">Score: <b id="score">0</b> ¬∑ Tries: <b id="tries">0</b> ¬∑ Stars: <b id="stars">‚òÜ‚òÜ‚òÜ</b></div>
      <div class="panel" id="diag" style="margin-top:8px">
        <div class="badge">Diagnostics</div>
        <div class="tiny">Run a quick self‚Äëtest to ensure canvas features work on this device.</div>
        <div class="row" style="margin-top:6px"><button class="primary" id="runTests">Run Self‚ÄëTest</button> <span id="testOut" class="tiny muted"></span></div>
      </div>
    </aside>
  </div>

<script>
const $=(s,el=document)=>el.querySelector(s); const $$=(s,el=document)=>[...el.querySelectorAll(s)];
let SCORE=0, TRIES=0; function add(n){SCORE+=n; TRIES++; $('#score').textContent=SCORE; $('#tries').textContent=TRIES; $('#stars').textContent= SCORE>=36?'‚òÖ‚òÖ‚òÖ':SCORE>=20?'‚òÖ‚òÖ‚òÜ':SCORE>=10?'‚òÖ‚òÜ‚òÜ':'‚òÜ‚òÜ‚òÜ';}
$$('.tab').forEach(t=>t.addEventListener('click',()=>{ $$('.tab').forEach(x=>x.classList.remove('active')); t.classList.add('active'); const id=t.dataset.tab; ({lead:renderLead,label:renderLabel,match:renderMatch,xylem:renderXylem,quiz:renderQuiz}[id])(); }));

// Robust ellipse helper (works across browsers + provides fallback)
function drawEllipse(ctx,x,y,rx,ry,rotation=0,start=0,end=Math.PI*2,anticw=false){
  if(typeof ctx.ellipse==='function'){
    try{ ctx.ellipse(x,y,rx,ry,rotation,start,end,anticw); return; }
    catch(e){ try{ ctx.ellipse(x,y,rx,ry,rotation,start,end); return; }catch(_){} }
  }
  // Fallback via scale + arc
  ctx.save(); ctx.translate(x,y); ctx.rotate(rotation); ctx.scale(rx,ry); ctx.beginPath(); ctx.arc(0,0,1,start,end,anticw); ctx.restore();
}

function renderLead(){ const v=$('#view'); v.innerHTML=`
  <div class="stage"><div>
    <p class="muted">Ask pupils:</p>
    <ul>
      <li>Who created all the beautiful plants we see? <b>Allah</b>.</li>
      <li>What parts can you name? <b>root, stem, leaf, flower</b> (plus seed/fruit for extension).</li>
      <li>What might each part do for the plant?</li>
    </ul>
    <div class="result">Use tabs from left to right. Encourage careful observation & gratitude.</div>
  </div></div>`; }

// 1) Label the Plant ‚Äî drag labels to SVG zones
function renderLabel(){ const v=$('#view'); v.innerHTML=`
  <div class="row"><button class="primary" id="reset">Reset</button> <button class="primary" id="check">Check</button> <button class="warn" id="easy">Less‚Äëable Mode</button></div>
  <div class="stage"><svg id="plantSVG" viewBox="0 0 520 340" aria-label="plant diagram">
    <!-- soil -->
    <rect x="0" y="260" width="520" height="80" fill="#1e293b"/>
    <!-- stem -->
    <rect x="252" y="150" width="16" height="110" fill="#16a34a" rx="8"/>
    <!-- leaves -->
    <ellipse cx="240" cy="200" rx="60" ry="24" fill="#22c55e"/>
    <ellipse cx="280" cy="220" rx="60" ry="24" fill="#22c55e"/>
    <!-- flower -->
    <circle cx="260" cy="130" r="12" fill="#f59e0b"/>
    <g fill="#f472b6">
      <circle cx="260" cy="110" r="10"/>
      <circle cx="240" cy="126" r="10"/>
      <circle cx="280" cy="126" r="10"/>
      <circle cx="248" cy="110" r="10"/>
      <circle cx="272" cy="110" r="10"/>
    </g>
    <!-- roots -->
    <path d="M260 260 l -20 30 M260 260 l 18 28 M260 270 l -35 35 M260 272 l 34 36" stroke="#b45309" stroke-width="6"/>

    <!-- drop zones -->
    <g font-size="12" fill="#9aa4b2">
      <rect id="z_root" x="30" y="290" width="120" height="26" rx="8" fill="#0b1220" stroke="#2a3646"/>
      <text x="90" y="307" text-anchor="middle">root</text>
      <rect id="z_stem" x="370" y="200" width="120" height="26" rx="8" fill="#0b1220" stroke="#2a3646"/>
      <text x="430" y="217" text-anchor="middle">stem</text>
      <rect id="z_leaf" x="360" y="240" width="120" height="26" rx="8" fill="#0b1220" stroke="#2a3646"/>
      <text x="420" y="257" text-anchor="middle">leaf</text>
      <rect id="z_flower" x="370" y="140" width="120" height="26" rx="8" fill="#0b1220" stroke="#2a3646"/>
      <text x="430" y="157" text-anchor="middle">flower</text>
    </g>
  </svg></div>
  <div class="panel" id="labels"></div>
  <div class="result" id="labOut"></div>`;
  const names=['root','stem','leaf','flower']; const host=$('#labels'); let easy=false;
  function chip(n){ const d=document.createElement('div'); d.className='chip big'; d.id='c_'+n; d.textContent=n; d.draggable=true; d.addEventListener('dragstart',e=>e.dataTransfer.setData('text/plain',d.id)); return d; }
  function setup(){ host.innerHTML=''; names.forEach(n=>host.appendChild(chip(n))); names.forEach(n=>{ const dz=$('#z_'+n); dz.dataset.fill=''; dz.addEventListener('dragover',e=>{e.preventDefault(); dz.setAttribute('stroke','#22c55e')}); dz.addEventListener('dragleave',()=>dz.setAttribute('stroke','#2a3646')); dz.addEventListener('drop',e=>{e.preventDefault(); dz.setAttribute('stroke','#2a3646'); const id=e.dataTransfer.getData('text/plain'); const el=document.getElementById(id); if(el){ dz.dataset.fill=id.replace('c_',''); el.style.opacity=0.25; el.draggable=false; if(easy){ dz.style.outline='2px solid #22c55e'; } }}); }); $('#labOut').textContent=''; }
  setup();
  $('#reset').onclick=setup; $('#easy').onclick=()=>{ easy=!easy; $('#easy').textContent=easy?'Standard Mode':'Less‚Äëable Mode'; setup(); };
  $('#check').onclick=()=>{ let ok=true; names.forEach(n=>{ if($('#z_'+n).dataset.fill!==n) ok=false; }); if(ok){ add(8); $('#labOut').innerHTML='<span class="ok">Excellent labelling!</span>'; } else { add(0); $('#labOut').innerHTML='<span class="err">Not yet. Drag each label to the correct zone.</span>'; }
  };
}

// 2) Match Part ‚Üí Function ‚Äî drag chips to function bins
function renderMatch(){ const v=$('#view'); v.innerHTML='';
  const ui=document.createElement('div'); ui.innerHTML=`
    <div class="row"><button class="primary" id="new">New Set</button> <button class="primary" id="check">Check</button> <button class="warn" id="easy">Less‚Äëable Mode</button></div>
    <div class="panel" style="margin-top:8px">
      <div class="badge">Drag each <b>part</b> to its <b>function</b></div>
      <div class="row" style="align-items:flex-start;gap:12px">
        <div style="flex:1"><div class="badge">Parts</div><div id="pool" class="drop"></div></div>
        <div style="flex:1"><div class="badge">üå± Takes in water & minerals from soil</div><div id="f_root" class="drop"></div></div>
        <div style="flex:1"><div class="badge">üì¶ Holds plant up & moves water</div><div id="f_stem" class="drop"></div></div>
        <div style="flex:1"><div class="badge">‚òÄÔ∏è Makes food (photosynthesis)</div><div id="f_leaf" class="drop"></div></div>
        <div style="flex:1"><div class="badge">üå∏ Makes seeds / fruit</div><div id="f_flower" class="drop"></div></div>
      </div>
    </div>
    <div class="result tiny">Extension ideas: add <b>seed</b> ‚Üí grows into new plant; <b>fruit</b> ‚Üí protects seeds.</div>
    <div class="result" id="out"></div>`; v.appendChild(ui);
  const parts=[{t:'root',f:'f_root'},{t:'stem',f:'f_stem'},{t:'leaf',f:'f_leaf'},{t:'flower',f:'f_flower'}]; let easy=false;
  function chip(a){ const d=document.createElement('div'); d.className='chip big'; d.textContent=a.t; d.id='p_'+a.t; d.draggable=true; d.dataset.f=a.f; d.addEventListener('dragstart',e=>e.dataTransfer.setData('text/plain',d.id)); return d; }
  function hookDZ(id){ const dz=$('#'+id); dz.addEventListener('dragover',e=>{e.preventDefault(); dz.style.outline='2px solid var(--ok)'}); dz.addEventListener('dragleave',()=>dz.style.outline='none'); dz.addEventListener('drop',e=>{e.preventDefault(); dz.style.outline='none'; const id=e.dataTransfer.getData('text/plain'); const el=document.getElementById(id); if(el){ dz.appendChild(el); if(easy){ if(el.dataset.f===dz.id) dz.style.boxShadow='0 0 0 2px #14532d inset'; else dz.style.boxShadow='0 0 0 2px #7f1d1d inset'; } }}); }
  function draw(){ const pool=$('#pool'); pool.innerHTML=''; parts.sort(()=>Math.random()-0.5).forEach(a=>pool.appendChild(chip(a))); ['f_root','f_stem','f_leaf','f_flower'].forEach(id=>{ $('#'+id).innerHTML=''; $('#'+id).style.boxShadow='none'; }); }
  ['pool','f_root','f_stem','f_leaf','f_flower'].forEach(hookDZ); draw();
  $('#new').onclick=draw; $('#easy').onclick=()=>{ easy=!easy; $('#easy').textContent=easy?'Standard Mode':'Less‚Äëable Mode'; draw(); };
  $('#check').onclick=()=>{ let ok=true; ['f_root','f_stem','f_leaf','f_flower'].forEach(id=>{ $$('#'+id+' .chip').forEach(c=>{ if(c.dataset.f!==id) ok=false; }); }); if(ok){ add(8); $('#out').innerHTML='<span class="ok">Great! Each part has a special job ‚Äî Alhamdulillah for this design.</span>'; } else { add(0); $('#out').innerHTML='<span class="err">Some parts do not match their function ‚Äî try again.</span>'; } };
}

// 3) Water Travel ‚Äî interactive xylem simulation & prediction
function renderXylem(){ const v=$('#view'); v.innerHTML=`
  <div class="row"><label>Speed: <span id="spdVal" class="mono">1x</span></label><input id="spd" type="range" min="1" max="4" value="1" step="1" style="width:220px"> <button class="primary" id="start">Start</button> <button class="warn" id="reset">Reset</button></div>
  <div class="stage"><canvas id="cv" width="620" height="300" style="max-width:100%;background:#0b1220;border:1px solid #253042;border-radius:12px"></canvas></div>
  <div class="panel tiny">Demonstration idea: colored water + celery/white flower. In the sim, dye travels from beaker ‚Üí up stem (xylem) ‚Üí to leaves/flower.</div>
  <div class="grid grid-2" style="margin-top:8px">
    <div class="panel">
      <div class="badge">Predict</div>
      <label>Where will the colour appear first? <input id="pred1" placeholder="stem edges / leaves / flower"></label>
      <label>Why do plants need stems? <input id="pred2" placeholder="move water / hold up"></label>
    </div>
    <div class="panel">
      <div class="badge">Explain (after watching)</div>
      <textarea id="obs" rows="3" placeholder="Describe the path of water and what you saw."></textarea>
    </div>
  </div>
  <div class="result" id="xyOut"></div>`;
  const c=$('#cv'), ctx=c.getContext('2d'); let t=0, anim=null, speed=1;
  function drawBase(){ ctx.clearRect(0,0,c.width,c.height);
    // beaker
    ctx.strokeStyle='#334155'; ctx.lineWidth=2; ctx.strokeRect(40,180,140,90);
    ctx.fillStyle='#1d4ed8'; ctx.fillRect(42,220,136,48); // water
    // stem (xylem channels as thin tubes)
    ctx.fillStyle='#16a34a'; ctx.fillRect(210,80,24,190); // stem body
    ctx.strokeStyle='#14532d'; for(let i=0;i<4;i++){ ctx.beginPath(); ctx.moveTo(222+i*2,260); ctx.lineTo(222+i*2,90); ctx.stroke(); }
    // leaf cluster
    ctx.fillStyle='#22c55e'; ctx.beginPath(); drawEllipse(ctx,300,120,70,26,0,0,Math.PI*2,false); ctx.fill();
    ctx.beginPath(); drawEllipse(ctx,260,150,60,24,0,0,Math.PI*2,false); ctx.fill();
    // flower
    ctx.fillStyle='#f59e0b'; ctx.beginPath(); ctx.arc(240,70,12,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#f472b6'; [ [240,50],[226,64],[254,64],[232,56],[248,56] ].forEach(p=>{ ctx.beginPath(); ctx.arc(p[0],p[1],9,0,Math.PI*2); ctx.fill(); });
    // stem in beaker
    ctx.fillStyle='#22c55e'; ctx.fillRect(110,120,12,120);
  }
  function drawDye(){ // animate rising dots along a polyline path
    const path=[ [116,265],[116,240],[116,220],[116,200],[116,180],[116,160],[116,140],[116,120], [222,260],[222,240],[222,220],[222,200],[222,180],[222,160],[222,140],[222,120],[222,100],[222,90], [240,80],[260,70] ];
    const total=path.length; const idx=Math.min(total-1, Math.floor(t)); for(let i=0;i<=idx;i++){ const p=path[i]; const alpha= i/total; ctx.fillStyle=`rgba(99,102,241,${0.4+0.6*alpha})`; ctx.beginPath(); ctx.arc(p[0],p[1], 5, 0, Math.PI*2); ctx.fill(); }
    if(idx>=total-1){ // colour reached flower; also tint leaves
      ctx.fillStyle='rgba(99,102,241,0.25)'; ctx.beginPath(); drawEllipse(ctx,300,120,70,26,0,0,Math.PI*2,false); ctx.fill();
      ctx.beginPath(); drawEllipse(ctx,260,150,60,24,0,0,Math.PI*2,false); ctx.fill();
    }
  }
  function frame(){ drawBase(); drawDye(); t+=0.25*speed; anim=requestAnimationFrame(frame); }
  drawBase();
  $('#spd').oninput=(e)=>{ speed=parseInt(e.target.value,10); $('#spdVal').textContent=speed+'x'; };
  $('#start').onclick=()=>{ if(anim) cancelAnimationFrame(anim); t=0; anim=requestAnimationFrame(frame); add(2); $('#xyOut').innerHTML='<span class="ok">Watch the dye move up ‚Äî like water in xylem.</span>'; };
  $('#reset').onclick=()=>{ if(anim) cancelAnimationFrame(anim); t=0; drawBase(); $('#xyOut').textContent=''; };
}

// 4) Quick Quiz ‚Äî 8 items (parts, functions, water travel)
function renderQuiz(){ const v=$('#view'); v.innerHTML='';
  const ui=document.createElement('div'); ui.innerHTML=`
    <div class="row"><button class="primary" id="newQ">New 8‚ÄëQ Set</button> <button class="primary" id="checkQ">Check</button> <button class="warn" id="hint">Hints</button></div>
    <div id="qs" style="margin-top:8px"></div>
    <div id="out" class="result"></div>`; v.appendChild(ui);
  const bank=[
    {t:'Roots take in water and minerals from soil.', a:'T'},
    {t:'Leaves make food using sunlight.', a:'T'},
    {t:'The stem helps move water to leaves and flower.', a:'T'},
    {t:'Flowers help make seeds or fruit.', a:'T'},
    {t:'In our experiment, the coloured water moves up the stem.', a:'T'},
    {t:'Plants are not living things.', a:'F'},
    {t:'Allah created plants with special parts and purposes.', a:'T'},
    {t:'ECOL7 reminds us plants are random without structure.', a:'F'}
  ];
  let set=[]; function gen(){ set=[...bank].sort(()=>Math.random()-0.5).slice(0,8); draw(); $('#out').textContent=''; }
  function draw(){ const host=$('#qs'); host.innerHTML=''; set.forEach((q,i)=>{ host.innerHTML+=`<div class="panel" style="margin-bottom:8px"><div><span class="badge">Q${i+1}</span> ${q.t}</div>
    <div class="row"><label><input type="radio" name="q${i}" value="T"> True</label> <label><input type="radio" name="q${i}" value="F"> False</label></div></div>`; }); }
  gen();
  $('#newQ').onclick=gen; $('#hint').onclick=()=>$('#out').innerHTML='Hints: root=drink, stem=move water & hold, leaf=make food, flower=seeds.';
  $('#checkQ').onclick=()=>{ let ok=0; set.forEach((q,i)=>{ const pick=($$("input[name='q"+i+"']:checked")[0]||{}).value; if(pick===q.a) ok++;}); if(ok===set.length){ add(10); $('#out').innerHTML='<span class="ok">Super work ‚Äî full marks!</span>'; } else { add(0); $('#out').innerHTML='<span class="err">Correct:</span> '+ok+' / '+set.length+' ‚Äî Review parts, functions & water travel.'; }
  };
}

// Diagnostics: run quick tests for ellipse availability & fallback
function runSelfTests(){
  const c=document.createElement('canvas'); c.width=200; c.height=120; const ctx=c.getContext('2d'); let passed=0, total=3; let msgs=[];
  try{ ctx.beginPath(); drawEllipse(ctx,100,60,50,20,0,0,Math.PI*2,false); ctx.fill(); passed++; msgs.push('ellipse helper OK (8 args).'); }catch(e){ msgs.push('ellipse helper FAILED (8 args).'); }
  try{ if(typeof CanvasRenderingContext2D!=="undefined" && CanvasRenderingContext2D.prototype.ellipse){ passed++; msgs.push('native ctx.ellipse exists.'); } else { msgs.push('native ctx.ellipse missing (fallback will be used).'); }
  }catch(e){ msgs.push('native check failed.'); }
  try{ // ensure no exception from quick renderXylem base draw
    const tempCtx=c.getContext('2d'); tempCtx.beginPath(); drawEllipse(tempCtx,50,40,30,12,0,0,Math.PI*2,false); tempCtx.fill(); passed++; msgs.push('render base draw OK.');
  }catch(e){ msgs.push('render base draw FAILED.'); }
  const out=$('#testOut'); if(out){ out.textContent=`Self‚ÄëTest: ${passed}/${total} passed ‚Äî ${msgs.join(' ')}`; }
}

// boot
renderLead();
$('#runTests')?.addEventListener('click', runSelfTests);
</script>
</body>
</html>
